#include <stdio.h>
int choice1(void);
int movieavail(void);
void reservation(void);
void reg();
void login();

struct user{
	char name[25];
	int phone[15];
	char password[20];	
	int age;
}w[99];

struct moviedetails{
	int seat;
	int id;
};
int n;
int id2=1000;
int price = 500;
int count=0;
struct user newuser[300];
struct moviedetails person[300];
int main(){
		
	
	 printf("*************** Registration *****************\n");
	 printf("enter your name: ");
	 scanf(" %19[^\n]%*[^\n]",&newuser[count].name);
	 printf("enter phone no :");
	 scanf("%d",&newuser[count].phone);
	 printf("enter age :");
	 scanf("%d",&newuser[count].age);
	 printf("enter your password :");
	 scanf("%s",&newuser[count].password);
	 system("cls");
	 printf("\nRegistration successful!\n");
    printf(" %s !! you are successfully registered\n", newuser[count].name);
	 printf("\n\n\n\n\t\t\tPress Enter to proceed...!!");
     if(getch()==13)
     XY:
     printf("\n\n\n\t\t\t1. LOGIN\t\t2. REGISTER");
     printf("\n\n\n\t\t\t\tENTER YOUR CHOICE: ");
     scanf("%d",&n);
     switch(n)
     {
    case 1: 
        login();
        break;
    case 2: 
        reg();
        break;
    default: printf("\n\n\t\t\t\tNO MATCH FOUND");
        printf("\n\n\t\t\tPress Enter to re-Enter the choice");
        if(getch()==13)
        goto XY;
  }
  return 0;
}
int i;
void reg()
  {
    FILE *fp;
    char c,checker[30]; int z=0;
    fp=fopen("Web_reg.txt","ab+");
    printf("\n\n\t\t\t\tWELCOME TO REGISTER ZONE");
    printf("\n\t\t\t\t^^^^^^^^^^^^^^^^^^^^^^^^");
    for(i=0;i<100;i++)
    {
      printf("\n\n\t\t\t\t  ENTER USERNAME: ");
      scanf("%s",checker);
        while(!feof(fp))
        {
          fread(&w[i],sizeof(w[i]),1,fp);
          if(strcmp(checker,w[i].name)==0)
            {
            printf("\n\n\t\t\tUSERNAME ALREDY EXISTS");
    
            reg();
            }
//          else
//          {
//            strcpy(w[i].name,checker);
//            break;
//          }
        }
      printf("\n\n\t\t\t\t  DESIRED PASSWORD: ");
      while((c=getch())!=13)
        {
          w[i].password[z++]=c;
          printf("%c",'*');
        }
      fwrite(&w[i],sizeof(w[i]),1,fp);
      fclose(fp);
      printf("\n\n\tPress enter if you agree with Username and Password");
      if((c=getch())==13)
        {
        printf("\n\n\t\tYou are successfully registered");
        printf("\n\n\t\tTry login your account??\n\n\t\t  ");
        printf("> PRESS 1 FOR YES\n\n\t\t  > PRESS 2 FOR NO\n\n\t\t\t\t");
        scanf("%d",&n);
        switch(n)
          {
              case 1: 
                    login();
                    break;
              case 2: 
                    printf("\n\n\n\t\t\t\t\tTHANK YOU FOR REGISTERING");
                    break;
          }
        }
        break;
      }
    getch();
  }
  void login()
    {
    	FILE *fp;
      char c,name[30],password[30]; int z=0;
      int checku,checkp;
      fp=fopen("Web_reg.txt","rb");
      printf("\n\n\t\t\t\tWELCOME TO LOG IN ZONE");
      printf("\n\t\t\t\t^^^^^^^^^^^^^^^^^^^^^^");
      for(i=0;i<1000;i++)
      {
        printf("\n\n\t\t\t\t  ENTER USERNAME: ");
        scanf("%s",name);
        printf("\n\n\t\t\t\t  ENTER PASSWORD: ");
        while((c=getch())!=13)
        {
          password[z++]=c;
          printf("%c",'*');
        }
        password[z]='\0';
      while(!feof(fp))
        {
        fread(&w[i],sizeof(w[i]),1,fp);
          checku=strcmp(name,w[i].name);
          checkp=strcmp(password,w[i].password);
          if(checku==0&&checkp==0)
          {
        
            printf("\n\n\n\t\t\tYOU HAVE LOGGED IN SUCCESSFULLY!!");
            printf("\n\n\n\t\t\t\tWELCOME, HAVE A NICE DAY");
            break;
          }
        else if(checku==0&&checkp!=0)
          {
            printf("\n\n\n\t\t\tWRONG PASSWORD!! Not %s??",name);
            printf("\n\n\t\t\t\t  (Press 'Y' to re-login)");
            if(getch()=='y'||getch()=='Y')
              login();
          }
        else if(checku!=0)
          {
            printf("\n\n\n\t\t\tYou are not a Registered User\n \t\t\tPress enter to register yourself");
            if(getch()==13)
            
            reg();
          }
        }
        break;
      }
      getch();
    
	int x=1;
	
	while(x>0){
	
	int choice=choice1();
	
	switch(choice){
		case 1:
			movieavail();
			break;
		case 2:
			reservation();
			payment();
			break;
		case 3:
			cancelticket();
			break;
					
	}

	}
}

int choice1(void)

{

	
	int choice;
	printf("                 Simple Movie Ticket Booking System\n");
	printf("||================================================================||\n");
	printf("||             1- TO DISPLAY THE CURRENT MOVIE AVAILABLE:         ||\n");
	printf("||             2- TO PURCHASE TICKET :                            ||\n");
	printf("||             3- TO CANCEL THE TICKET:                           ||\n");
	printf("||             4- EXIT				                              ||\n");
	printf("||================================================================||\n");
	printf("  Enter your choice: ");
	scanf("%d",&choice);
	return choice;
}
int movieavail(void){
	system("cls");
	printf("================================================================\n");
	printf("||            movies available are----->:                      ||\n");
	printf("||            Ant-Man And The Wasp: Quantumania                ||\n");
	printf("||            Avatar : Age of Water                            ||\n");
	printf("||            Gadar 2: The Katha Continues                     ||\n");
	printf("||            Dil Wale Dulhaniya Le Jayenge                    ||\n");
	printf("||            Tu Jhuthhi Mai Makkar                            ||\n");
	printf("================================================================\n");
}
void reservation(void)
{
	int sel;
	char card_num[20], expiration_date[10];
	int cvv, otp;


	printf("//          WHICH MOVIE YOU WANT TO SEE           //\n");
	printf("----------------------------------------------------------------\n");
	printf("//          press 1 for ANT-MAN AND THE WASP: QUANTUMANIA        \n");
	printf("//          press 2 for Avatar: Age of Water                     \n");
	printf("//          press 3 for gadar2: The katha continues              \n");
	printf("//          press 4 for Dil Wale Dulhaniya Le Jayenge            \n");
	printf("//          press 5 for tu Jhuthhi mai makkar                    \n");
	printf("enter your choice :");
	scanf("%d",&sel);
	system("cls");
	int i,j,*array;
	printf("\n                                SCREEN\n\n\n");
		for (i=1;i<=100;i++)
		{
			if (array[i]==0)
				printf("%d\t",i);
			else 
				printf("%d\t",i);	
			if(i%10==0)
				printf("\n\n");
		}
		printf("welcome !! %s .. we are blessed with your visit   \n",newuser[count].name);
		printf("enter the seat number you want : ");
		scanf("%d",&person[count].seat);
		switch(sel)
		{
			case 1:
			printf("*-----------------*\n");
			printf("       ANT-MAN AND THE WASP: QUANTUMANIA \n");
			printf("       (1) 11Am - 1Pm\n");
			printf("       (2) 4Pm  - 6Pm\n");
			int d;
			printf("*-----------------------*\n");
			printf(" Choose Movie Slot Number:  ");
			scanf("%d",&d);
			switch(d)
			{
				case 1:
					printf("*-----------------*\n");
					printf(" ANT-MAN AND THE WASP: QUANTUMANIA :  11Am - 1Pm\n");
					printf("=================================================================\n");
					system("cls");
					printf("\n\n");
       				 printf("\t-----------------MOVIE BOOKING TICKET----------------\n");
       				 printf("\t============================================================\n");
       				 printf("\t Booking ID : %d \t\t\tANT-MAN AND THE WASP: QUANTUMANIA\n",id2);
       				 printf("\t Customer  : %s\n",newuser[count].name);
       				 printf("\t\t\t                              Date      : 20-04-2023\n");
       				 printf("\t                                              Time      : 11:00 Am\n");
        			printf("\t                                              Hall      : 02\n");
       				printf("\t                                              seats No. : %d  \n",person[count].seat);
       				printf("\t                                              price . : %d  \n\n",price);
        			printf("\t============================================================\n");
					break;
				case 2:
					printf("*-----------------*\n");
					printf("  ANT-MAN AND THE WASP: QUANTUMANIA:   4Pm  - 6Pm\n");
					printf("=================================================================\n");
					system("cls");
					printf("\t-----------------THEATER BOOKING TICKET----------------\n");
       				
       				 printf("\t Booking ID : %d \t\t\tANT-MAN AND THE WASP: QUANTUMANIA\n",id2);
       				 printf("\t Customer  : %s\n",newuser[count].name);
       				 printf("\t\t\t                              Date      : 20-04-2023\n");
       				 printf("\t                                              Time      : 4:00 Pm\n");
        			printf("\t                                              Hall      : 02\n");
       				printf("\t                                              seats No. : %d  \n",person[count].seat);
       				printf("\t                                              price . : %d  \n\n",price);
        			printf("\t============================================================\n");
					
					break;
			}
			

        return;
			break;
			case 2:
				printf("*-------------------------*\n");
				printf(" Avatar: Age of Water:  \n");
				printf("              (1) 1Pm - 4Pm\n");
				printf("              (2) 8Pm - 10Pm\n");
				int e;
				printf("*-----------------------*\n");
				printf(" Choose Movie Slot Number:  ");
				scanf("%d",&e);
				switch(e){
					case 1:
						printf("*-----------------*\n");
						printf(" Avatar: Age of Water:  1pm - 4Pm\n");
						printf("=================================================================\n");
						system("cls");
					 printf("\t-----------------THEATER BOOKING TICKET----------------\n");
       				 printf("\t============================================================\n");
       				 printf("\t Booking ID : %d \t\t\tAvatar: Age of Water\n",id2);
       				 printf("\t Customer  : %s\n",newuser[count].name);
       				 printf("\t\t\t                              Date      : 20-04-2023\n");
       				 printf("\t                                              Time      : 1:00 pm\n");
        			printf("\t                                              Hall      : 02\n");
       				printf("\t                                              seats No. : %d  \n",person[count].seat);
       				printf("\t                                              price . : %d  \n\n",price);
        			printf("\t============================================================\n");
						break;
					case 2:
						printf("*-----------------*\n");
						printf("  Avatar: Age of Water:   8Pm  - 10Pm\n");
						printf("=================================================================\n");
						system("cls");
						printf("\t-----------------THEATER BOOKING TICKET----------------\n");
       				 printf("\t============================================================\n");
       				 printf("\t Booking ID : %d \t\t\tAvatar: Age of Water\n",id2);
       				 printf("\t Customer  : %s\n",newuser[count].name);
       				 printf("\t\t\t                              Date      : 20-04-2023\n");
       				 printf("\t                                              Time      : 8:00 pm\n");
        			printf("\t                                              Hall      : 02\n");
       				printf("\t                                              seats No. : %d  \n",person[count].seat);
       				printf("\t                                              price . : %d  \n\n",price);
        			printf("\t============================================================\n");
					}
				break;		
			
			case 3:
			printf("*-------------------------*\n");
			printf(" gadar2: The katha continues :  \n");
			printf("              (1) 1Pm - 4Pm\n");
			printf("               (2) 8Pm - 10Pm\n");
			int f;
			printf("*-----------------------*\n");
			printf(" Choose Movie Slot Number:  ");
			scanf("%d",&f);
			switch(f){
				case 1:
					printf("*-----------------*\n");
					printf(" gadar2: The katha continues :  1pm - 4Pm\n");
					printf("=================================================================\n");
					system("cls");
					printf("\t-----------------THEATER BOOKING TICKET----------------\n");
       				 printf("\t============================================================\n");
       				 printf("\t Booking ID : %d \t\t\tgadar2: The katha continues\n",id2);
       				 printf("\t Customer  : %s\n",newuser[count].name);
       				 printf("\t\t\t                              Date      : 20-04-2023\n");
       				 printf("\t                                              Time      : 1:00 pm\n");
        			printf("\t                                              Hall      : 02\n");
       				printf("\t                                              seats No. : %d  \n",person[count].seat);
       				printf("\t                                              price . : %d  \n\n",price);
        			printf("\t============================================================\n");
					break;
				case 2:
					printf("*-----------------*\n");
					printf("  gadar2: The katha continues :   4Pm  - 6Pm\n");
					printf("=================================================================\n");
					system("cls");
					printf("\t-----------------THEATER BOOKING TICKET----------------\n");
       				 printf("\t============================================================\n");
       				 printf("\t Booking ID : %d \t\t\tgadar2: The katha continues\n",id2);
       				 printf("\t Customer  : %s\n",newuser[count].name);
       				 printf("\t\t\t                              Date      : 20-04-2023\n");
       				 printf("\t                                              Time      : 4:00 pm\n");
        			printf("\t                                              Hall      : 02\n");
       				printf("\t                                              seats No. : %d  \n",person[count].seat);
       				printf("\t                                              price . : %d  \n\n",price);
        			printf("\t============================================================\n");
					
				}
			break;
			case 4:
			printf("*-------------------------*\n");
			printf("  Dil Wale Dulhaniya Le Jayenge  :  \n");
			printf("              (1) 1Pm - 4Pm\n");
			printf("               (2) 8Pm - 10Pm\n");
			int g;
			printf("*-----------------------*\n");
			printf(" Choose Movie Slot Number:  ");
			scanf("%d",&g);
			switch(f){
				case 1:
					printf("*-----------------*\n");
					printf("  Dil Wale Dulhaniya Le Jayenge  :  11Am - 1Pm\n");
					printf("=================================================================\n");
					system("cls");
					printf("\t-----------------THEATER BOOKING TICKET----------------\n");
       				 printf("\t============================================================\n");
       				 printf("\t Booking ID : %d \t\t\tDil Wale Dulhaniya Le Jayenge\n",id2);
       				 printf("\t Customer  : %s\n",newuser[count].name);
       				 printf("\t\t\t                              Date      : 20-04-2023\n");
       				 printf("\t                                              Time      : 1:00 pm\n");
        			printf("\t                                              Hall      : 02\n");
       				printf("\t                                              seats No. : %d  \n",person[count].seat);
       				printf("\t                                              price . : %d  \n\n",price);
        			printf("\t============================================================\n");
					break;
				case 2:
					printf("*-----------------*\n");
					printf("   Dil Wale Dulhaniya Le Jayenge  :   4Pm  - 6Pm\n");
					printf("=================================================================\n");
					system("cls");
						printf("\t-----------------THEATER BOOKING TICKET----------------\n");
					 printf("\t============================================================\n");
       				 printf("\t Booking ID : %d \t\t\tDil Wale Dulhaniya Le Jayenge\n",id2);
       				 printf("\t Customer  : %s\n",newuser[count].name);
       				 printf("\t\t\t                              Date      : 20-04-2023\n");
       				 printf("\t                                              Time      : 4:00 pm\n");
        			printf("\t                                              Hall      : 02\n");
       				printf("\t                                              seats No. : %d  \n",person[count].seat);
       				printf("\t                                              price . : %d  \n\n",price);
        			printf("\t============================================================\n");
				}
			break;
			case 5:
			printf("*-------------------------*\n");
			printf("  tu Jhuthhi mai makkar  :  \n");
			printf("              (1) 1Pm - 4Pm\n");
			printf("               (2) 8Pm - 10Pm\n");
			int h;
			printf("*-----------------------*\n");
			printf(" Choose Movie Slot Number:  ");
			scanf("%d",&h);
			switch(f){
				case 1:
					printf("*-----------------*\n");
					printf("  tu Jhuthhi mai makkar   :  11Am - 1Pm\n");
					printf("=================================================================\n");
					system("cls");
					printf("\t-----------------THEATER BOOKING TICKET----------------\n");
					 printf("\t============================================================\n");
       				 printf("\t Booking ID : %d \t\t\ttu Jhuthhi mai makkar\n",id2);
       				 printf("\t Customer  : %s\n",newuser[count].name);
       				 printf("\t\t\t                              Date      : 20-04-2023\n");
       				 printf("\t                                              Time      : 11:00 Am\n");
        			printf("\t                                              Hall      : 02\n");
       				printf("\t                                              seats No. : %d  \n",person[count].seat);
       				printf("\t                                              price . : %d  \n\n",price);
        			printf("\t============================================================\n");
					break;
				case 2:
					printf("*-----------------*\n");
					printf("   tu Jhuthhi mai makkar   :   4Pm  - 6Pm\n");
					printf("=================================================================\n");
					system("cls");
					printf("\t-----------------THEATER BOOKING TICKET----------------\n");
					printf("\t============================================================\n");
       				 printf("\t Booking ID : %d \t\t\ttu Jhuthhi mai makkar\n",id2);
       				 printf("\t Customer  : %s\n",newuser[count].name);
       				 printf("\t\t\t                              Date      : 20-04-2023\n");
       				 printf("\t                                              Time      : 4:00pm\n");
        			printf("\t                                              Hall      : 02\n");
       				printf("\t                                              seats No. : %d  \n",person[count].seat);
       				printf("\t                                              price . : %d  \n\n",price);
        			printf("\t============================================================\n");
	
				}
			break;
			default:
				printf("please enter a valid choice\n");
				printf("=================================================================\n");
		}
		
}
				

int cancelticket()
{
	char pass[20];
	printf("===========================================================================\n");
	printf("||         CANCEL YOUR TICKET            ||\n");
	printf("enter your password : ");
	scanf("%s",&pass);
	if(strcmp(pass,newuser[count].password)==0)
	{
		printf("%s your ticket has been cancelled \n",newuser[count].name);
		printf("bad to see you going\n");
	}
	else
	{
		printf("|| ===================== ||\n");
		printf("please enter the correct password \n");
	}
		
}
int payment(void){
	char card_num[20], expiration_date[10];
	int cvv, otp;
	printf("==============================   PAYMENT GATEWAY   ==============================\n");
	printf("Please make payment of %d amount for reserving your seat \n",price);
    	printf("        Enter Card Details         \n");
   		printf("===================================\n");
   		printf("Card Number : ");
    	scanf("%s", &card_num);
    	printf("Expiration Date(MM/YY) : ");
    	scanf("%s", &expiration_date);
    	printf("CVV : ");
    	scanf("%d", &cvv);
    	printf("===================================\n");
    	printf("Generating OTP.....................\n");
    	printf("OTP : ");
    	scanf("%d", &otp);
    	printf("Payment Done Successfully..........\n");
    	printf("=====CONGRATULATION YOUR SEAT HAS BEEN RESERVED ========\n");
    	printf("=============================================================================\n");
	choice1();
}
